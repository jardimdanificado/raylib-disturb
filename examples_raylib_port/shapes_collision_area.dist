// raylib [shapes] example - collision area (Disturb port)
// Source: shapes/shapes_collision_area.c

eval(read("examples_raylib_port/common.dist"));
name = "shapes_collision_area";
if (port_has_display() == 0) {
  cv = beginOffscreenColor(180, 110, PORT_RAYWHITE);
  mx = 80;
  my = 60;
  // Deterministic overlap equivalent for headless mode.
  hit = 1;
  offscreenDrawRect(cv, 60, 45, 40, 30, PORT_LIGHTGRAY);
  offscreenDrawRect(cv, mx - 8, my - 8, 16, 16, PORT_SKYBLUE);
  if (hit == 1) { offscreenDrawRect(cv, 20, 20, 20, 10, PORT_RED); }
  ok = 0;
  if (hit == 1) {
    if (assertPixelEquals(name, cv, 22, 22, PORT_RED) == 1) { ok = 1; }
  }
  if (ok == 1) { port_pass_headless(name); }
  else { port_fail(name, "collision invariant failed"); }
}
else {
  port_window_begin(800, 450, "raylib shapes: collision area");
  frame = 0;
  while (raylib_phase3.rl2_WindowShouldClose() == 0 && frame < 120) {
    frame = frame + 1;
    mx = raylib_phase3.rl2_GetMouseX();
    my = raylib_phase3.rl2_GetMouseY();
    hit = raylib_phase3.rl2_CheckCollisionRecs(mx - 20.0, my - 20.0, 40.0, 40.0, 320.0, 170.0, 180.0, 120.0);

    raylib_phase3.rl2_BeginDrawing();
    raylib_phase3.rl2_ClearBackground(PORT_RAYWHITE);
    raylib_phase3.rl2_DrawRectangle(320, 170, 180, 120, PORT_LIGHTGRAY);
    raylib_phase3.rl2_DrawRectangle(mx - 20, my - 20, 40, 40, PORT_SKYBLUE);
    if (hit == 1) {
      raylib_phase3.rl2_DrawText("COLLISION!", 350, 140, 24, PORT_RED);
    }
    else {
      raylib_phase3.rl2_DrawText("Move mouse square", 320, 140, 24, PORT_DARKGRAY);
    }
    raylib_phase3.rl2_EndDrawing();
  }
  port_window_end();
  port_pass_windowed(name);
}
