// Phase 3 smoke: texture load/draw/unload with asset-aware skip.

if (system("test -n \"$DISTURB_HEADLESS\"") == 0 || system("test -n \"$DISPLAY\"") != 0 || system("xdpyinfo >/dev/null 2>&1") != 0) {
  println("phase3 smoke_texture skipped (headless environment)");
}
else if (system("test -f assets/test.png") != 0) {
  println("phase3 smoke_texture skipped (missing assets/test.png)");
}
else {
  eval(read("generated/raylib_ffi_phase3.dist"));

  rgba = (r, g, b, a){
    return ((r & 255) << 24) | ((g & 255) << 16) | ((b & 255) << 8) | (a & 255);
  };

  COLOR_BG = rgba(245, 245, 245, 255);
  COLOR_TINT = rgba(255, 255, 255, 255);

  raylib_phase3.rl2_InitWindow(480, 270, "phase3 texture");
  raylib_phase3.rl2_SetTargetFPS(60);

  tex = raylib_phase3.rl2_LoadTexture("assets/test.png");
  if (tex == null) {
    println("phase3 smoke_texture skipped (LoadTexture returned null)");
    raylib_phase3.rl2_CloseWindow();
  }
  else {
    frame = 0;
    max_frames = 120;
    while (raylib_phase3.rl2_WindowShouldClose() == 0 && frame < max_frames) {
      frame = frame + 1;

      raylib_phase3.rl2_BeginDrawing();
      raylib_phase3.rl2_ClearBackground(COLOR_BG);
      raylib_phase3.rl2_DrawTexture(tex, 100, 60, COLOR_TINT);
      raylib_phase3.rl2_EndDrawing();
    }

    raylib_phase3.rl2_UnloadTexture(tex);
    raylib_phase3.rl2_CloseWindow();
    println("phase3 smoke_texture finished");
  }
}
